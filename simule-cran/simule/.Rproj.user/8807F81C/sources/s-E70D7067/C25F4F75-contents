library(neurobase)

setwd("C:/Users/Karen Chen/Desktop")

test = readnii("sub-Caltech0051456_ses-1_mask.nii.gz")

max(test)

data = readnii("Caltech_0051457_alff.nii.gz")

atlas = readnii("aal_roi_atlas.nii.gz")

unique(data)

datadata = data@.Data

unique(datadata)

datadata = as.matrix(datadata)

unique(datadata)

mean(datadata)

max(datadata)

sd(datadata)

atlasdata = as.matrix(atlas@.Data)

unique(atlasdata)


library(oro.nifti)

data_masked = mask_img(data, )

ortho2(data_masked)

ortho2(data)

library('brainKCCA')

#It will take more than 3 min to run
filePath <- tempdir()
#the nii.gz fMRI imaging file is created (toy example)
oro.nifti::writeNIfTI(brainKCCA::input_img, paste(filePath, "/", "temp", sep=""))
#read fMRI data
testcase1 <- nii2RData(niiFile1 = "temp", resolution = "3mm", imgPath = filePath)
result1<-permkCCA_multipleRegion(imageDat = testcase1, region = c(1,5,10))
summary_result1 <- summary_kcca(kcca_object=result1, saveFormat = "excel")
write.csv(summary_result1, paste(filePath, "/", "temp.csv", sep=""))
summary_data <- meanConnection(path = filePath, threshold=0.25)
multipleRegion_plot(summary_data, view = "SL", significance=NA)

library(neurobase)
library(oro.nifti)
setwd("C:/Users/Karen Chen/Downloads")
braintemplate = readnii("MNI152_T1_1mm_brain.nii")
braintemplatedata = braintemplate@.Data
braintemplatedata = as.matrix(braintemplate@.Data)

ortho2(braintemplate)
unique(braintemplatedata)
max(braintemplatedata)
min(braintemplatedata)
ave(braintemplatedata)

misc3d::contour3d(braintemplatedata, level = 1000 ,alpha = 0.2, draw = TRUE, add=TRUE)

plot(brain)
library("plotly")

stuff = braintemplate@.Data
braintemplatedataframe=data.frame(stuff)
plot_ly(type= 'surface', z = ~volcano)

plot_ly(tyep= 'scatter3d', x = c( 9, 8, 5, 1 ) , y = c( 1, 2, 4, 8 ) , z = c( 11, 8, 15, 3 ) , mode = 'lines' )

misc3d::slices3d(braintemplate)
install.packages('tkrplot
                 ')


misc3d::contour3d(data, level = 100,alpha = 0.2, draw = TRUE,add=TRUE)










#### start from here for ABIDE plotting
### load template
library(neurobase)
setwd("C:/Users/Karen Chen/Downloads")
braintemplate = readnii("MNI152_T1_1mm_brain.nii")
setwd("C:/Users/Karen Chen/Desktop/Spring 2018/Demo/niidata")
caltechbrain = readnii("Caltech_0051457_alff.nii.gz")
caltechbrain = caltechbrain@.Data
library(misc3d)
### testing for misc3d contour plot
misc3d::contour3d(braintemplate, level =  4500, alpha = 1, draw = TRUE, add=TRUE)

### steps to obtain graph, label and graphlayout(coordinates)
{
setwd("E:/ABIDE_info")

load("ABIDE_aal116_timeseries.rdata")

### create label
label = read.csv("aal_labels.csv")

label = label[,2]

label = label[-1]

label = as.vector(label)

result = simule(ABIDE_aal116_timeseries, 0.2, 1, covType = "cov", TRUE)

### graph to visualize
graph = returngraph.simule(result, type = "neighbour", neighbouroption = "task", index = 1)


aal116coordinates = brainGraph::aal116

### layout for the graph obtained from AAL116 coordinates
layout = cbind(aal116coordinates$x.mni + 90,aal116coordinates$y.mni+126, aal116coordinates$z.mni+72)
}


### this is the plotting functionality in rglplot
{
rglplot(
  graph,
  layout = layout,
  vertex.label.font = 2,
  vertex.shape = "circle",
  vertex.label.color = "black",
  vertex.color = as.integer(aal116$lobe),
  vertex.label = label,
  edge.width= 100,
  vertex.label.cex = .7,
  vertex.size = 300,
  vertex.frame.color = "white",
  add = TRUE,
  rescale = FALSE
)

misc3d::contour3d(braintemplate, level = 3000,alpha = 0.5, draw = TRUE,add=TRUE,  rescale = FALSE)
}





##start from here Jamie Plotting
setwd("E:/Jamie_Info")
load("JamieData.rdata")
load("JamieCoordinates.rdata")
label = as.matrix(read.csv("MNI_CenterOrigin_Brain_Mask_Coordinates.csv"))[,1]

result = simule(JamieData, 0.5, 1, covType = "cov", TRUE)

graph = returngraph.simule(result)

layout = cbind(JamieCoordinates[,1],JamieCoordinates[,2], JamieCoordinates[,3])

library(neurobase)
setwd("C:/Users/Karen Chen/Downloads")
braintemplate = readnii("MNI152_T1_1mm_brain.nii")
{
  rglplot(
    graph,
    layout = layout,
    vertex.label.font = 2,
    vertex.shape = "circle",
    vertex.label.color = "black",
    vertex.color = "black",
    vertex.label = label,
    edge.width= 100,
    vertex.label.cex = .7,
    vertex.size = 300,
    vertex.frame.color = "white",
    add = TRUE,
    rescale = FALSE
  )

  misc3d::contour3d(braintemplate, level = 3000,alpha = 0.5, draw = TRUE,add=TRUE,  rescale = FALSE)
}

bgplot3d({
  plot.new()
  title(main = 'title', line = 3)
  legend(
    "topright" ,
    legend = c(1:4),
    col = rainbow(4),
    pch = 16,cex=1, inset=c(0.02)
  )
  legend(
    "topleft" ,
    legend = c(1:4),
    col = categorical_pal(4),
    pch = 16,cex=1, inset=c(0.02)
  )
})



